<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Merino API documentation"><meta name="keywords" content="rust, rustlang, rust-lang, api"><title>merino::docs::api - Rust</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../../merino/index.html'><div class='logo-container rust-logo'><img src='../../../rust-logo.png' alt='logo'></div></a><h2 class="location">Module api</h2><div class="sidebar-elems"><div id="sidebar-vars" data-name="api" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input"name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">merino</a>::<wbr><a href="../index.html">docs</a>::<wbr><a class="mod" href="#">api</a><button id="copy-path" onclick="copy_path(this)" title="copy path"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item import" title="Copy item import to clipboard"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../../src/merino/docs/api.rs.html#1-144" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h1 id="merino-api-documentation" class="section-header"><a href="#merino-api-documentation">Merino API documentation</a></h1>
<p>This page describes the API endpoints available on Merino.</p>
<h2 id="suggest" class="section-header"><a href="#suggest">Suggest</a></h2>
<p>Endpoint: <code>/api/v1/suggest</code></p>
<p>Example: <code>/api/v1/suggest?q=nelson%20mand</code></p>
<p>The primary endpoint for the browser to consume, this endpoint consumes user
input and suggests pages the user may want to visit. The expectation is that
this is shown alongside other content the browser suggests to the user, such as
bookmarks and history.</p>
<p>This endpoint accepts GET requests and takes parameters as query string values
and headers.</p>
<h3 id="query-parameters" class="section-header"><a href="#query-parameters">Query Parameters</a></h3>
<ul>
<li><code>q</code> - The query that the user has typed. This is expected to be a partial
input, sent as fast as once per keystroke, though a slower period may be
appropriate for the user agent.</li>
</ul>
<h3 id="headers" class="section-header"><a href="#headers">Headers</a></h3>
<ul>
<li>
<p><code>Accept-Language</code> - The locale preferences expressed in this header in
accordance with <a href="https://datatracker.ietf.org/doc/html/rfc2616/#section-14.4">RFC 2616 section 14.4</a> will be used to determine suggestions.
Merino maintains a list of supported locales. Merino will choose the
locale from it’s list that has the highest <code>q</code> (quality) value in the
user’s <code>Accept-Language</code> header. Locales with <code>q=0</code> will not be used.</p>
<p>If no locales match, Merino will not return any suggestions. If the
header is not included or empty, Merino will default to the <code>en-US</code> locale.</p>
<p>If the highest quality, compatible language produces no suggestion results,
Merino will return an empty list instead of attempting to query other
languages.</p>
</li>
<li>
<p><code>User-Agent</code> - A user’s device form factor, operating system, and browser/Firefox version
are detected from the <code>User-Agent</code> header included in the request.</p>
</li>
</ul>
<h3 id="other-derived-inputs" class="section-header"><a href="#other-derived-inputs">Other derived inputs</a></h3>
<ul>
<li>
<p>Location - The IP address of the user or nearest proxy will be used to
determine location. This location may be as granular as city level, depending
on server configuration.</p>
<p>Users that use VPN services will be identified according to the VPN exit
node they use, allowing them to change Merino’s understanding of their
location. VPN exit nodes are often mis-identified in geolocation databases,
and may produce unreliable results.</p>
</li>
</ul>
<h3 id="response" class="section-header"><a href="#response">Response</a></h3>
<p>The response will be a JSON object containing a single key, <code>suggestions</code>, which
will be a list of suggestion objects. Each suggestion object will have the
following keys:</p>
<ul>
<li>
<p><code>block_id</code> - a number that can be used, along with the <code>provider</code> field below, to
uniquely identify this suggestion. Two suggestions with the same <code>provider</code>
and <code>block_id</code> should be treated as the same suggestion, even if other
fields, such as <code>click_url</code> change. Merino will enforce that they are
equivalent from a user’s point of view.</p>
</li>
<li>
<p><code>full_keyword</code> - In the case that the query was a partial match to the
suggestion, this is the completed query that would also match this query. For
example, if the user was searching for fruit and typed “appl”, this field
might contain the string “apples”. This is suitable to show as a completion
of the user’s input. This field should be treated as plain text.</p>
</li>
<li>
<p><code>title</code> - The full title of the suggestion resulting from the query. Using the
example of apples above, this might be “Types of Apples in the Pacific
Northwest”. This field should be treated as plain text.</p>
</li>
<li>
<p><code>url</code> - The URL of the page that should be navigated to if the user selects
this suggestion. This will be a resource with the title specified in the
<code>title</code> field.</p>
</li>
<li>
<p><code>impression_url</code> - A provider specified telemetry URL that should be notified
if the browser shows this suggestion to the user. This is used along with
<code>click_url</code> to monitor the relevancy of suggestions. For more details see
<a href="#interaction-pings">Interaction Pings</a>, below. This field may be null, in which
case no impression ping is required for this suggestion provider.</p>
</li>
<li>
<p><code>click_url</code> - A provider specified telemetry URL that should be notified
if the user selects this suggestion. This should only be notified as the result
of positive user action, and only if the user has navigated to the page specified
in the <code>url</code> field. For more details see <a href="#interaction-pings">Interaction Pings</a>,
below. This field may be null, in which case no click ping is required for this
suggestion provider.</p>
</li>
<li>
<p><code>provider</code> - A string that identifies the source of this suggestion. This can
be used along with <code>block_id</code> to uniquely identify this suggestion. It is not
intended to be directly displayed to the user.</p>
</li>
<li>
<p><del><code>advertiser</code></del> - A deprecated alias of <code>provider</code>.</p>
</li>
<li>
<p><code>is_sponsored</code> - A boolean indicating if this suggestion is sponsored content.
If this is true, the UI must indicate to the user that the suggestion is
sponsored.</p>
</li>
<li>
<p><code>icon</code> - A URL of an image to display alongside the suggestion. This will be a
small square image, suitable to be included inline with the text, such as a
site’s favicon.</p>
</li>
<li>
<p><code>score</code> - A value between 0.0 and 1.0 used to compare suggestions. When
choosing a suggestion to show the user, higher scored suggestions are
preferred.</p>
</li>
</ul>
<h3 id="response-headers" class="section-header"><a href="#response-headers">Response Headers</a></h3>
<p>Responses will carry standard HTTP caching headers that indicate the validity of
the suggestions. User agents should prefer to provide the user with cached
results as indicated by these headers.</p>
<h3 id="response-status-codes" class="section-header"><a href="#response-status-codes">Response Status Codes</a></h3>
<ul>
<li>200 OK - Suggestions provided normally.</li>
<li>4xx - Client error. See response for details.</li>
<li>5xx - Internal server error. Try again later.</li>
</ul>
<p><a id="interaction-pings"></a></p>
<h2 id="interaction-pings" class="section-header"><a href="#interaction-pings">Interaction Pings</a></h2>
<p>When a Firefox user views or selects a suggestion from Merino, Firefox will
send an impression or a click ping to a Mozilla-controlled service indicating
this user interaction. Some suggestion providers may also need that interaction
data for reporting and relevancy optimization. Firefox will not send the pings
to those providers directly, rather, it will delegate those to a Mozilla-controlled
service, by which the interaction pings will be sent to the <code>impression_url</code> or
<code>click_url</code> specified by the providers.</p>
<p>If the URL for an interaction ping is not specified (for example, <code>click_url</code>
is <code>null</code>), then no ping should be sent to the provider for that action. However,
this interaction ping is always sent to the Mozilla-controlled service unless
the user opts out the telemetry collection of Firefox.</p>
<p>The required behavior for interaction pings is TBD.</p>
</div></details></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="merino" data-search-index-js="../../../search-index.js" data-search-js="../../../search.js"></div>
    <script src="../../../main.js"></script>
</body></html>